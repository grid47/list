<!DOCTYPE html>
<html lang="en-us"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="generator" content="Hugo 0.136.4">
	
	<link rel="icon" href="/images/logo.png">
	
	<title>Leetcode 1993: Operations on Tree | grid47</title>
	
	

	
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Leetcode 1993: Operations on Tree">
  <meta name="twitter:description" content="In-depth solution and explanation for Leetcode 1993: Operations on Tree in C&#43;&#43;. Includes clear intuition, step-by-step example walkthrough, and detailed complexity analysis.">

	<meta property="og:url" content="http://localhost:1313/leetcode/leetcode-1993-operations-on-tree/">
  <meta property="og:site_name" content="grid47">
  <meta property="og:title" content="Leetcode 1993: Operations on Tree">
  <meta property="og:description" content="In-depth solution and explanation for Leetcode 1993: Operations on Tree in C&#43;&#43;. Includes clear intuition, step-by-step example walkthrough, and detailed complexity analysis.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="leetcode">
    <meta property="article:published_time" content="2024-04-21T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-11-06T00:00:00+00:00">
    <meta property="article:tag" content="Array">
    <meta property="article:tag" content="Hash Table">
    <meta property="article:tag" content="Tree">
    <meta property="article:tag" content="Depth-First Search">
    <meta property="article:tag" content="Breadth-First Search">
    <meta property="article:tag" content="Design">


	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">

	
	<link rel="stylesheet" href="http://localhost:1313/css/medium.ced6b291f6520a092efe4c87ca4fc7047e1c3174b10653f78e13ca06f0bb6abf.css" integrity="sha256-ztaykfZSCgku/kyHyk/HBH4cMXSxBlP3jhPKBvC7ar8=">

	
	<link rel="stylesheet" href="http://localhost:1313/css/additional.8819b6defcdc6d21280f9b402b00df87ca779135901de6c22e708c62e20184b9.css" integrity="sha256-iBm23vzcbSEoD5tAKwDfh8p3kTWQHebCLnCMYuIBhLk=">

	
	
	<link rel="stylesheet" href="/css/head.css" integrity="" crossorigin="anonymous" media="screen">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">
    <div class="container pr-0">
        
        <a class="navbar-brand" href="http://localhost:1313//">

            
            <img src="/images/logo.png" alt="logo">
            
        </a>
        

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbarMediumish">
            
            <ul class="navbar-nav ml-auto">
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">About</a>
                </li>
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/leetcode/">LeetCode</a>
                </li>
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/terms/">Terms &amp; Policy</a>
                </li>
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/contact/">Contact</a>
                </li>
                
            </ul>
        </div>
        
    </div>
</nav>


        <div class="site-content">   
            <div class="container">
<div class="main-content">

<div class="container">
	<div class="row">
        <div class="col-md-1"></div>
		<div class="col-md-10">
			<div class="mainheading">
				<h1 class="posttitle">Leetcode 1993: Operations on Tree</h1> 
            </div>
			<div class="article-post">
				<hr>
<p><strong>Code:</strong></p>
<h2 id="hahahugoshortcode495s0hbhb"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">class</span> <span style="color:#00f">LockingTree</span> {
</span></span><span style="display:flex;"><span>    vector<span style="color:#666">&lt;</span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#666">&gt;</span> nodes;
</span></span><span style="display:flex;"><span>    vector<span style="color:#666">&lt;</span>vector<span style="color:#666">&lt;</span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#666">&gt;&gt;</span> chd;
</span></span><span style="display:flex;"><span>    map<span style="color:#666">&lt;</span><span style="color:#0b0;font-weight:bold">int</span>, <span style="color:#0b0;font-weight:bold">int</span><span style="color:#666">&gt;</span> mp;
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#666">:</span>
</span></span><span style="display:flex;"><span>    LockingTree(vector<span style="color:#666">&lt;</span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#666">&gt;&amp;</span> parent) {
</span></span><span style="display:flex;"><span>        nodes <span style="color:#666">=</span> parent;
</span></span><span style="display:flex;"><span>        <span style="color:#080;font-style:italic">// chd.resize(parent.size(), vector&lt;int&gt;());
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>        <span style="color:#080;font-style:italic">// for(int i = 1; i &lt; parent.size(); i++) 
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>        <span style="color:#080;font-style:italic">//     chd[parent[i]].push_back(i);
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>
</span></span><span style="display:flex;"><span>        vector<span style="color:#666">&lt;</span>vector<span style="color:#666">&lt;</span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#666">&gt;&gt;</span>temp(parent.size());
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">for</span>(<span style="color:#0b0;font-weight:bold">int</span> i<span style="color:#666">=</span><span style="color:#666">1</span>;i<span style="color:#666">&lt;</span>parent.size();i<span style="color:#666">++</span>){
</span></span><span style="display:flex;"><span>            temp[parent[i]].push_back(i);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        chd<span style="color:#666">=</span>temp;
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#0b0;font-weight:bold">bool</span> <span style="color:#00a000">lock</span>(<span style="color:#0b0;font-weight:bold">int</span> num, <span style="color:#0b0;font-weight:bold">int</span> user) {
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span>(mp.find(num)<span style="color:#666">==</span>mp.end()){
</span></span><span style="display:flex;"><span>            mp[num]<span style="color:#666">=</span>user;
</span></span><span style="display:flex;"><span>            <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">true</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">false</span>;;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       <span style="color:#080;font-style:italic">//  if(mp.count(num)) return false;
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>       <span style="color:#080;font-style:italic">//  
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>       <span style="color:#080;font-style:italic">//  mp[num] = user;
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>       <span style="color:#080;font-style:italic">//  return true;
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#0b0;font-weight:bold">bool</span> <span style="color:#00a000">unlock</span>(<span style="color:#0b0;font-weight:bold">int</span> num, <span style="color:#0b0;font-weight:bold">int</span> user) {
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span>(mp.find(num)<span style="color:#666">!=</span>mp.end()){
</span></span><span style="display:flex;"><span>            <span style="color:#a2f;font-weight:bold">if</span>(mp[num]<span style="color:#666">==</span>user){
</span></span><span style="display:flex;"><span>                mp.erase(num);
</span></span><span style="display:flex;"><span>                <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">true</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">false</span>;        
</span></span><span style="display:flex;"><span>        <span style="color:#080;font-style:italic">// if(!mp[num]) return false;
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>        <span style="color:#080;font-style:italic">// if(mp[num] != user) return false;
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>        <span style="color:#080;font-style:italic">// mp.erase(num);
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>        <span style="color:#080;font-style:italic">// return true;
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#0b0;font-weight:bold">bool</span> <span style="color:#00a000">check</span>(<span style="color:#0b0;font-weight:bold">int</span> num) {
</span></span><span style="display:flex;"><span>        <span style="color:#080;font-style:italic">// cout&lt;&lt; num &lt;&lt; mp[num];        
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>        <span style="color:#a2f;font-weight:bold">if</span>(mp.find(num)<span style="color:#666">!=</span>mp.end()) <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">true</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span>(mp.count(num)) <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">true</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#080;font-style:italic">// cout&lt;&lt; num &lt;&lt; &#34;-&#34;&lt;&lt; nodes[num];
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>        <span style="color:#a2f;font-weight:bold">if</span>(nodes[num] <span style="color:#666">!=</span> <span style="color:#666">-</span><span style="color:#666">1</span> <span style="color:#666">&amp;&amp;</span> check(nodes[num])) <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">true</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#0b0;font-weight:bold">void</span> <span style="color:#00a000">desc</span>(<span style="color:#0b0;font-weight:bold">int</span> num, <span style="color:#0b0;font-weight:bold">int</span> <span style="color:#666">&amp;</span>total) {
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">for</span>(<span style="color:#0b0;font-weight:bold">int</span> <span style="color:#a0a000">n</span> : chd[num]) {
</span></span><span style="display:flex;"><span>            <span style="color:#a2f;font-weight:bold">if</span>(mp.count(n)) 
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                mp.erase(n);
</span></span><span style="display:flex;"><span>                total<span style="color:#666">++</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            desc(n, total);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#0b0;font-weight:bold">bool</span> <span style="color:#00a000">upgrade</span>(<span style="color:#0b0;font-weight:bold">int</span> num, <span style="color:#0b0;font-weight:bold">int</span> user) {
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span>(mp.find(num)<span style="color:#666">!=</span>mp.end()) <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">false</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        cout<span style="color:#666">&lt;&lt;</span> <span style="color:#b44">&#34;hi&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span>(check(num)) <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">false</span>;
</span></span><span style="display:flex;"><span>        cout<span style="color:#666">&lt;&lt;</span> <span style="color:#b44">&#34;hi1&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#0b0;font-weight:bold">int</span> total <span style="color:#666">=</span> <span style="color:#666">0</span>;
</span></span><span style="display:flex;"><span>        desc(num, total);
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span>(total <span style="color:#666">==</span> <span style="color:#666">0</span>) <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        mp[num] <span style="color:#666">=</span> user;
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> * Your LockingTree object will be instantiated and called as such:
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> * LockingTree* obj = new LockingTree(parent);
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> * bool param_1 = obj-&gt;lock(num,user);
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> * bool param_2 = obj-&gt;unlock(num,user);
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> * bool param_3 = obj-&gt;upgrade(num,user);
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> */</span></span></span></code></pre></div></h2>
<h3 id="problem-statement">Problem Statement</h3>
<p>The problem involves creating a locking tree data structure that allows for the management of node locking and unlocking operations in a tree. The tree is defined by a parent array where each index represents a node, and the value at that index represents its parent. The locking mechanism includes three main operations:</p>
<ol>
<li><strong>Lock a Node</strong>: A user can lock a node if it is not already locked.</li>
<li><strong>Unlock a Node</strong>: A user can unlock a node if they are the one who locked it.</li>
<li><strong>Upgrade a Node</strong>: A node can be upgraded if it is not locked and at least one of its descendants is locked. During an upgrade, the node becomes locked, and all locked descendants are unlocked.</li>
</ol>
<p>The objective is to implement these functionalities efficiently in the <code>LockingTree</code> class.</p>
<h3 id="approach">Approach</h3>
<p>To implement the <code>LockingTree</code>, we can use the following approach:</p>
<ol>
<li>
<p><strong>Data Structures</strong>:</p>
<ul>
<li><strong>Parent Array</strong>: To store the parent of each node.</li>
<li><strong>Children List</strong>: A list of vectors to maintain the children of each node for easy traversal.</li>
<li><strong>Map for Locks</strong>: A map that tracks the current user who has locked each node.</li>
</ul>
</li>
<li>
<p><strong>Operations</strong>:</p>
<ul>
<li><strong>Lock</strong>: Check if the node is already locked. If not, lock it by adding it to the map.</li>
<li><strong>Unlock</strong>: Check if the node is locked by the same user. If so, remove it from the map.</li>
<li><strong>Check</strong>: Traverse up the tree to check if any ancestor is locked.</li>
<li><strong>Descendants</strong>: Traverse down the tree to count and unlock all descendants.</li>
<li><strong>Upgrade</strong>: Ensure the node is not locked and check if any descendants are locked. If valid, lock the node and unlock all its locked descendants.</li>
</ul>
</li>
</ol>
<h3 id="code-breakdown-step-by-step">Code Breakdown (Step by Step)</h3>
<p>Here is a detailed explanation of the provided code:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">class</span> <span style="color:#00f">LockingTree</span> {
</span></span><span style="display:flex;"><span>    vector<span style="color:#666">&lt;</span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#666">&gt;</span> nodes;
</span></span><span style="display:flex;"><span>    vector<span style="color:#666">&lt;</span>vector<span style="color:#666">&lt;</span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#666">&gt;&gt;</span> chd;
</span></span><span style="display:flex;"><span>    map<span style="color:#666">&lt;</span><span style="color:#0b0;font-weight:bold">int</span>, <span style="color:#0b0;font-weight:bold">int</span><span style="color:#666">&gt;</span> mp; <span style="color:#080;font-style:italic">// Map to track locked nodes and their user IDs
</span></span></span></code></pre></div><p>We define a class <code>LockingTree</code> with three member variables: <code>nodes</code> to store the parent information, <code>chd</code> for the children of each node, and <code>mp</code> which maps locked nodes to the users who locked them.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#666">:</span>
</span></span><span style="display:flex;"><span>    LockingTree(vector<span style="color:#666">&lt;</span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#666">&gt;&amp;</span> parent) {
</span></span><span style="display:flex;"><span>        nodes <span style="color:#666">=</span> parent;
</span></span><span style="display:flex;"><span>        vector<span style="color:#666">&lt;</span>vector<span style="color:#666">&lt;</span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#666">&gt;&gt;</span>temp(parent.size());
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">for</span>(<span style="color:#0b0;font-weight:bold">int</span> i<span style="color:#666">=</span><span style="color:#666">1</span>;i<span style="color:#666">&lt;</span>parent.size();i<span style="color:#666">++</span>){
</span></span><span style="display:flex;"><span>            temp[parent[i]].push_back(i);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        chd<span style="color:#666">=</span>temp;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>The constructor initializes the tree based on the parent array. It creates a children list by iterating through the parent array and adding child nodes to their respective parents.</p>
<h4 id="lock-operation">Lock Operation</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>    <span style="color:#0b0;font-weight:bold">bool</span> <span style="color:#00a000">lock</span>(<span style="color:#0b0;font-weight:bold">int</span> num, <span style="color:#0b0;font-weight:bold">int</span> user) {
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span>(mp.find(num)<span style="color:#666">==</span>mp.end()){
</span></span><span style="display:flex;"><span>            mp[num]<span style="color:#666">=</span>user; <span style="color:#080;font-style:italic">// Lock the node for the user
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>            <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">true</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>The <code>lock</code> method checks if the node <code>num</code> is already locked. If it is not, it locks the node by inserting it into the map with the user&rsquo;s ID and returns <code>true</code>. If it is locked, it returns <code>false</code>.</p>
<h4 id="unlock-operation">Unlock Operation</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>    <span style="color:#0b0;font-weight:bold">bool</span> <span style="color:#00a000">unlock</span>(<span style="color:#0b0;font-weight:bold">int</span> num, <span style="color:#0b0;font-weight:bold">int</span> user) {
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span>(mp.find(num)<span style="color:#666">!=</span>mp.end()){
</span></span><span style="display:flex;"><span>            <span style="color:#a2f;font-weight:bold">if</span>(mp[num]<span style="color:#666">==</span>user){ <span style="color:#080;font-style:italic">// Check if the unlocking user matches
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>                mp.erase(num); <span style="color:#080;font-style:italic">// Unlock the node
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>                <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">true</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">false</span>; <span style="color:#080;font-style:italic">// User does not match
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">false</span>;        
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>The <code>unlock</code> method checks if the node is locked and whether the user unlocking it is the same one who locked it. If both conditions are met, it unlocks the node by removing it from the map and returns <code>true</code>. Otherwise, it returns <code>false</code>.</p>
<h4 id="check-operation">Check Operation</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>    <span style="color:#0b0;font-weight:bold">bool</span> <span style="color:#00a000">check</span>(<span style="color:#0b0;font-weight:bold">int</span> num) {
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span>(mp.find(num)<span style="color:#666">!=</span>mp.end()) <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">true</span>; <span style="color:#080;font-style:italic">// Node is locked
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>        <span style="color:#a2f;font-weight:bold">if</span>(nodes[num] <span style="color:#666">!=</span> <span style="color:#666">-</span><span style="color:#666">1</span> <span style="color:#666">&amp;&amp;</span> check(nodes[num])) <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">true</span>; <span style="color:#080;font-style:italic">// Check parent
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>        <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>The <code>check</code> method verifies if a node or any of its ancestors are locked. It returns <code>true</code> if it finds a locked ancestor, otherwise <code>false</code>.</p>
<h4 id="descendants-traversal">Descendants Traversal</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>    <span style="color:#0b0;font-weight:bold">void</span> <span style="color:#00a000">desc</span>(<span style="color:#0b0;font-weight:bold">int</span> num, <span style="color:#0b0;font-weight:bold">int</span> <span style="color:#666">&amp;</span>total) {
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">for</span>(<span style="color:#0b0;font-weight:bold">int</span> <span style="color:#a0a000">n</span> : chd[num]) {
</span></span><span style="display:flex;"><span>            <span style="color:#a2f;font-weight:bold">if</span>(mp.count(n)) {
</span></span><span style="display:flex;"><span>                mp.erase(n); <span style="color:#080;font-style:italic">// Unlock the descendant
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>                total<span style="color:#666">++</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            desc(n, total); <span style="color:#080;font-style:italic">// Recursive call for children
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>The <code>desc</code> method is used to count and unlock all locked descendants of a given node. It iterates through the children, unlocking each one and incrementing the total count.</p>
<h4 id="upgrade-operation">Upgrade Operation</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>    <span style="color:#0b0;font-weight:bold">bool</span> <span style="color:#00a000">upgrade</span>(<span style="color:#0b0;font-weight:bold">int</span> num, <span style="color:#0b0;font-weight:bold">int</span> user) {
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span>(mp.find(num)<span style="color:#666">!=</span>mp.end()) <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">false</span>; <span style="color:#080;font-style:italic">// Cannot upgrade if locked
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span>(check(num)) <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">false</span>; <span style="color:#080;font-style:italic">// Cannot upgrade if an ancestor is locked
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>        
</span></span><span style="display:flex;"><span>        <span style="color:#0b0;font-weight:bold">int</span> total <span style="color:#666">=</span> <span style="color:#666">0</span>;
</span></span><span style="display:flex;"><span>        desc(num, total); <span style="color:#080;font-style:italic">// Count locked descendants
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>        <span style="color:#a2f;font-weight:bold">if</span>(total <span style="color:#666">==</span> <span style="color:#666">0</span>) <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">false</span>; <span style="color:#080;font-style:italic">// No locked descendants to upgrade
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>
</span></span><span style="display:flex;"><span>        mp[num] <span style="color:#666">=</span> user; <span style="color:#080;font-style:italic">// Lock the current node
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>        <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>The <code>upgrade</code> method checks if the node is already locked or has locked ancestors. If neither is true, it counts locked descendants using <code>desc</code>. If at least one locked descendant is found, it locks the current node and returns <code>true</code>; otherwise, it returns <code>false</code>.</p>
<h3 id="complexity">Complexity</h3>
<ul>
<li>
<p><strong>Time Complexity</strong>:</p>
<ul>
<li><strong>Lock</strong>: (O(1)) – checking and inserting into the map takes constant time.</li>
<li><strong>Unlock</strong>: (O(1)) – checking and removing from the map also takes constant time.</li>
<li><strong>Check</strong>: (O(h)) where (h) is the height of the tree, as it may need to traverse up to the root.</li>
<li><strong>Descendants</strong>: (O(n)) in the worst case if all nodes are descendants.</li>
<li><strong>Upgrade</strong>: (O(n + h)) due to counting descendants and checking for locked ancestors.</li>
</ul>
</li>
<li>
<p><strong>Space Complexity</strong>:</p>
<ul>
<li>The space complexity is (O(n)) for storing the tree structure and the lock map.</li>
</ul>
</li>
</ul>
<h3 id="conclusion">Conclusion</h3>
<p>The <code>LockingTree</code> class efficiently manages locking and unlocking operations in a tree structure. By using a combination of a parent array for structure and a map for tracking locked nodes, the implementation allows for quick operations while maintaining the integrity of the tree. This structure is particularly useful for scenarios where resource locking and hierarchical relationships are important.</p>
<h3 id="example-usage">Example Usage</h3>
<p>Here’s how you can utilize the <code>LockingTree</code> class:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#080">#include</span> <span style="color:#080">&lt;iostream&gt;</span><span style="color:#080">
</span></span></span><span style="display:flex;"><span><span style="color:#080">#include</span> <span style="color:#080">&lt;vector&gt;</span><span style="color:#080">
</span></span></span><span style="display:flex;"><span><span style="color:#080"></span><span style="color:#a2f;font-weight:bold">using</span> <span style="color:#a2f;font-weight:bold">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0b0;font-weight:bold">int</span> <span style="color:#00a000">main</span>() {
</span></span><span style="display:flex;"><span>    vector<span style="color:#666">&lt;</span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#666">&gt;</span> parent <span style="color:#666">=</span> {<span style="color:#666">-</span><span style="color:#666">1</span>, <span style="color:#666">0</span>, <span style="color:#666">0</span>, <span style="color:#666">1</span>, <span style="color:#666">1</span>}; <span style="color:#080;font-style:italic">// Example parent array
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    LockingTree<span style="color:#666">*</span> tree <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> LockingTree(parent);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cout <span style="color:#666">&lt;&lt;</span> tree<span style="color:#666">-&gt;</span>lock(<span style="color:#666">2</span>, <span style="color:#666">1</span>) <span style="color:#666">&lt;&lt;</span> endl; <span style="color:#080;font-style:italic">// Should return true
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    cout <span style="color:#666">&lt;&lt;</span> tree<span style="color:#666">-&gt;</span>lock(<span style="color:#666">3</span>, <span style="color:#666">2</span>) <span style="color:#666">&lt;&lt;</span> endl; <span style="color:#080;font-style:italic">// Should return true
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    cout <span style="color:#666">&lt;&lt;</span> tree<span style="color:#666">-&gt;</span>unlock(<span style="color:#666">2</span>, <span style="color:#666">1</span>) <span style="color:#666">&lt;&lt;</span> endl; <span style="color:#080;font-style:italic">// Should return true
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    cout <span style="color:#666">&lt;&lt;</span> tree<span style="color:#666">-&gt;</span>upgrade(<span style="color:#666">0</span>, <span style="color:#666">3</span>) <span style="color:#666">&lt;&lt;</span> endl; <span style="color:#080;font-style:italic">// Should return true
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    cout <span style="color:#666">&lt;&lt;</span> tree<span style="color:#666">-&gt;</span>lock(<span style="color:#666">1</span>, <span style="color:#666">4</span>) <span style="color:#666">&lt;&lt;</span> endl; <span style="color:#080;font-style:italic">// Should return false (already locked)
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a2f;font-weight:bold">delete</span> tree; <span style="color:#080;font-style:italic">// Clean up
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#666">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This example initializes a <code>LockingTree</code>, performs various lock and unlock operations, and demonstrates how the locking mechanism works effectively in a hierarchical structure.</p>
<p><a href="https://leetcode.com/problems/operations-on-tree/description/"><code>Link to LeetCode Lab</code></a></p>
<hr>


    
    <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
      <iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" loading="eager" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/qK4PtjrVD0U?autoplay=0&controls=1&end=0&loop=0&mute=0&start=0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="YouTube video"
      ></iframe>
    </div>

<table>
  <thead>
      <tr>
          <th><a href="https://grid47.xyz/leetcode/">LeetCode Solutions Library</a> / <a href="https://grid47.xyz/sheets/">DSA Sheets</a> / <a href="https://grid47.xyz/courses/">Course Catalog</a></th>
      </tr>
  </thead>
  <tbody>
  </tbody>
</table>

			</div>
		</div>
        <div class="col-md-1"></div>
	</div>
</div>

</div>


            </div>
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                &copy; Copyright www.grid47.com - All rights reserved
            </div>
            
        </div>
    </div>
</footer>


        </div>


<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>


<script src="http://localhost:1313/js/mediumish.84218587c174fd40bce82544b98851670f0b124a7324b349c54a4065e2b32ffc.js" integrity="sha256-hCGFh8F0/UC86CVEuYhRZw8LEkpzJLNJxUpAZeKzL/w="></script>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-1LN7R4LHR1"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-1LN7R4LHR1');
        }
      </script>
    </body>
</html>
